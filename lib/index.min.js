"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeStore=initializeStore,exports.updateStore=updateStore,exports.addObserver=addObserver,exports.addEvent=addEvent,exports.addEvents=addEvents,exports.removeEvent=removeEvent,exports.removeEvents=removeEvents,exports.emitEvent=emitEvent,exports.emitEvents=emitEvents,exports.store=void 0;function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var eventBus={},emitEventCycle=null,observers=[],id=0,updatePointer=0,shouldPersist=!1,persistStorage=null,persistTimeout=null,persistedStateKeys=null,useJSON=!0,store={};exports.store=store;function initializeStore(a,b){if(exports.store=store=a.initialStore,!1===a.useJSON&&(useJSON=!1),"persist"in a)if("asyncStorage"in a.persist)persistStorage=a.persist.asyncStorage,persistStorage.getItem("fluxible-js").then(function(c){var d=c?useJSON?JSON.parse(c):c:store,e=a.persist.restore(_objectSpread(_objectSpread({},store),d));persistedStateKeys=Object.keys(e),persistedStateKeys.forEach(function(a){store[a]=e[a]}),b&&b()});else{persistStorage=a.persist.syncStorage;var c=persistStorage.getItem("fluxible-js"),d=c?useJSON?JSON.parse(c):c:store,e=a.persist.restore(_objectSpread(_objectSpread({},store),d));persistedStateKeys=Object.keys(e),persistedStateKeys.forEach(function(a){store[a]=e[a]})}}function updateStore(a){persistTimeout&&(clearTimeout(persistTimeout),persistTimeout=null);var c=Object.keys(a),d=c.length;c.forEach(function(b){store[b]=a[b],persistedStateKeys&&!shouldPersist&&-1<persistedStateKeys.indexOf(b)&&(shouldPersist=!0)}),updatePointer=0;for(var h=observers.length;updatePointer<h;updatePointer++){var i=observers[updatePointer];if(i){var e=i.keys,f=i.callback,g=e.length;if(d<g){for(var j=0;j<d;j++)if(-1<e.indexOf(c[j])){f();break}}else for(var b=0;b<g;b++)if(-1<c.indexOf(e[b])){f();break}}}updatePointer=0,shouldPersist&&(persistTimeout=setTimeout(function(){if(persistTimeout){var a={};persistedStateKeys.forEach(function(b){a[b]=store[b]}),persistStorage.setItem("fluxible-js",useJSON?JSON.stringify(a):a),shouldPersist=!1}},200))}function addObserver(a,b){var c=id;return observers.push({callback:a,keys:b,id:c}),id++,function(){for(var b,d=observers.length,e=0;e<d;e++)if(b=observers[e],b&&b.id===c)return null!==updatePointer&&e<=updatePointer&&updatePointer--,observers.splice(e,1)}}function addEvent(b,c){return b in eventBus?eventBus[b].push(c):eventBus[b]=[c],function(){if(b in eventBus)for(var d=eventBus[b].length,e=0;e<d;e++)if(eventBus[b][e]===c)return emitEventCycle&&emitEventCycle.ev===b&&e<=emitEventCycle.pointer&&(emitEventCycle.pointer--,emitEventCycle.eventBusLen--),eventBus[b].splice(e,1);return-1}}function addEvents(a,b){var c=a.map(function(a){return addEvent(a,b)});return function(){c.forEach(function(a){a()})}}function removeEvent(a){return a in eventBus?void delete eventBus[a]:-1}function removeEvents(a){a.forEach(function(a){removeEvent(a)})}function emitEvent(a,b){if(!(a in eventBus))return-1;for(emitEventCycle={ev:a,pointer:0,eventBusLen:eventBus[a].length};emitEventCycle.pointer<emitEventCycle.eventBusLen;emitEventCycle.pointer++){var c=eventBus[a][emitEventCycle.pointer];c&&c(b)}emitEventCycle=null}function emitEvents(a,b){a.forEach(function(a){emitEvent(a,b)})}