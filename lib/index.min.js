"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeStore=initializeStore,exports.updateStore=updateStore,exports.addObserver=addObserver,exports.addEvent=addEvent,exports.emitEvent=emitEvent,exports.store=void 0;function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var eventBus={},observers=[],id=0,removedObserverIndex=null,shouldPersist=!1,persistStorage=0,persistTimeout=0,persistedStateKeys=0,persistedStateKeysLen=0,store={};exports.store=store;function exists(b,c){for(var d=0,a=b.length;d<a;d+=1)if(b[d]===c)return!0;return!1}function initializeStore(b){if(exports.store=store=_objectSpread({},b.initialStore),"persist"in b){var c=b.persist.restore(JSON.parse(b.persist.storage.getItem("fluxible-js"))||{});persistedStateKeys=Object.keys(c),persistedStateKeysLen=persistedStateKeys.length,persistStorage=b.persist.storage;for(var d=0;d<persistedStateKeysLen;d+=1)store[persistedStateKeys[d]]=c[persistedStateKeys[d]]}}function updateStore(c){0!==persistTimeout&&(clearTimeout(persistTimeout),persistTimeout=0);for(var d=Object.keys(c),e=d.length,f=0;f<e;f+=1)store[d[f]]=c[d[f]],!shouldPersist&&0!==persistedStateKeys&&exists(persistedStateKeys,d[f])&&(shouldPersist=!0);for(var g=0,h=observers.length;g<h;g+=1)if(observers[g]){var i=observers[g].wantedKeys.length;if(e<i){for(var j=0;j<e;j+=1)if(exists(observers[g].wantedKeys,d[j])){observers[g].callback();break}}else for(var b=0;b<e;b+=1)if(exists(d,observers[g].wantedKeys[b])){observers[g].callback();break}null!==removedObserverIndex&&(removedObserverIndex<=g&&(g-=1),removedObserverIndex=null)}shouldPersist&&(persistTimeout=setTimeout(function(){if(0!==persistTimeout){for(var a={},b=0;b<persistedStateKeysLen;b+=1)a[persistedStateKeys[b]]=store[persistedStateKeys[b]];persistStorage.setItem("fluxible-js",JSON.stringify(a)),shouldPersist=!1}},200))}function addObserver(a,b){var c=id;return observers.push({callback:a,wantedKeys:b,id:c}),id+=1,function(){for(var b=0,a=observers.length;b<a;b+=1)if(observers[b]&&observers[b].id===c)return removedObserverIndex=b,observers.splice(b,1)}}function addEvent(a,b){a in eventBus?eventBus[a].push(b):eventBus[a]=[b]}function emitEvent(b,c){if(b in eventBus)for(var d=eventBus[b].length,e=0;e<d;e+=1)eventBus[b][e]&&eventBus[b][e](c);return-1}