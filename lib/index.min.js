"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeStore=initializeStore,exports.getStore=getStore,exports.updateStore=updateStore,exports.addObserver=addObserver,exports.addEvent=addEvent,exports.emitEvent=emitEvent;function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var eventBus={},observers=[],store={},shouldPersist=!1,persistStorage=0,persistTimeout=0,persistedStateKeys=0;function initializeStore(b){if(store=_objectSpread({},b.initialStore),b.persist){var c=b.persist.restore(JSON.parse(b.persist.storage.getItem("fluxible-js"))||{});persistedStateKeys=Object.keys(c),persistStorage=b.persist.storage;for(var d=0;d<persistedStateKeys.length;d++)store[persistedStateKeys[d]]=c[persistedStateKeys[d]]}}function getStore(){return store}function updateStore(c){0!==persistTimeout&&(clearTimeout(persistTimeout),persistTimeout=0);for(var d=Object.keys(c),e=0;e<d.length;e++)store[d[e]]=c[d[e]],0===persistedStateKeys||shouldPersist||-1===persistedStateKeys.indexOf(d[e])||(shouldPersist=!0);for(var f=0;f<observers.length;f++)if(d.length<observers[f].wantedKeys.length){for(var g=0;g<d.length;g++)if(-1!==observers[f].wantedKeys.indexOf(d[g])){observers[f].callback(store);break}}else for(var b=0;b<observers[f].wantedKeys.length;b++)if(-1!==d.indexOf(observers[f].wantedKeys[b])){observers[f].callback(store);break}shouldPersist&&(persistTimeout=setTimeout(function(){if(0!==persistTimeout){for(var a={},b=0;b<persistedStateKeys.length;b++)a[persistedStateKeys[b]]=store[persistedStateKeys[b]];persistStorage.setItem("fluxible-js",JSON.stringify(a)),shouldPersist=!1}},200))}function addObserver(a,b){var c={callback:a,wantedKeys:b,id:Math.random()};return observers.push(c),function(){for(var b=0;b<observers.length;b++)if(observers[b].id===c.id)return observers.splice(b,1)}}function addEvent(a,b){eventBus[a]===void 0?eventBus[a]=[b]:eventBus[a].push(b)}function emitEvent(b,c){if(!eventBus[b])return-1;for(var d=0;d<eventBus[b].length;d++)eventBus[b][d](c)}