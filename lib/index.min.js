"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initializeStore=initializeStore,exports.updateStore=updateStore,exports.addObserver=addObserver,exports.addEvent=addEvent,exports.removeEvent=removeEvent,exports.emitEvent=emitEvent,exports.store=void 0;var eventBus={},emitEventCycle=null,observers=[],id=0,updateCounter=null,shouldPersist=!1,persistStorage=0,persistTimeout=0,persistedStateKeys=0,persistedStateKeysLen=0,useJSON=!0,store={};exports.store=store;function initializeStore(b,c){if(exports.store=store=b.initialStore,!1===b.useJSON&&(useJSON=!1),"persist"in b)if("asyncStorage"in b.persist)b.persist.asyncStorage.getItem("fluxible-js").then(function(d){var e=b.persist.restore(d?useJSON?JSON.parse(d):d:store);persistedStateKeys=Object.keys(e),persistedStateKeysLen=persistedStateKeys.length,persistStorage=b.persist.asyncStorage;for(var f=0;f<persistedStateKeysLen;f+=1)store[persistedStateKeys[f]]=e[persistedStateKeys[f]];c&&c()});else{var d=b.persist.syncStorage.getItem("fluxible-js"),e=b.persist.restore(d?useJSON?JSON.parse(d):d:store);persistedStateKeys=Object.keys(e),persistedStateKeysLen=persistedStateKeys.length,persistStorage=b.persist.syncStorage;for(var f=0;f<persistedStateKeysLen;f+=1)store[persistedStateKeys[f]]=e[persistedStateKeys[f]]}}function updateStore(c){0!==persistTimeout&&(clearTimeout(persistTimeout),persistTimeout=0);for(var d=Object.keys(c),e=d.length,f=0;f<e;f+=1)store[d[f]]=c[d[f]],0!==persistedStateKeys&&!shouldPersist&&-1<persistedStateKeys.indexOf(d[f])&&(shouldPersist=!0);updateCounter=0;for(var g=observers.length;updateCounter<g;updateCounter+=1)if(observers[updateCounter]){var h=observers[updateCounter].wantedKeys.length;if(1===e&&-1<observers[updateCounter].wantedKeys.indexOf(d[0])||1===h&&-1<d.indexOf(observers[updateCounter].wantedKeys[0]))observers[updateCounter].callback();else if(e<h){for(var i=0;i<e;i+=1)if(-1<observers[updateCounter].wantedKeys.indexOf(d[i])){observers[updateCounter].callback();break}}else for(var b=0;b<h;b+=1)if(-1<d.indexOf(observers[updateCounter].wantedKeys[b])){observers[updateCounter].callback();break}}updateCounter=null,shouldPersist&&(persistTimeout=setTimeout(function(){if(0!==persistTimeout){for(var a={},b=0;b<persistedStateKeysLen;b+=1)a[persistedStateKeys[b]]=store[persistedStateKeys[b]];persistStorage.setItem("fluxible-js",useJSON?JSON.stringify(a):a),shouldPersist=!1}},200))}function addObserver(a,b){var c=id;return observers.push({callback:a,wantedKeys:b,id:c}),id+=1,function(){for(var b=0,a=observers.length;b<a;b+=1)if(observers[b]&&observers[b].id===c)return null!==updateCounter&&b<=updateCounter&&(updateCounter-=1),observers.splice(b,1)}}function addEvent(b,c){return b in eventBus?eventBus[b].push(c):eventBus[b]=[c],function(){if(b in eventBus)for(var d=eventBus[b].length,e=0;e<d;e+=1)if(eventBus[b][e]===c)return null!==emitEventCycle&&emitEventCycle.ev===b&&e<=emitEventCycle.counter&&(emitEventCycle.counter-=1),eventBus[b].splice(e,1);return-1}}function removeEvent(a){return!1==a in eventBus?-1:void delete eventBus[a]}function emitEvent(a,b){if(!1==a in eventBus)return-1;emitEventCycle={ev:a,counter:0};for(var c=eventBus[a].length;emitEventCycle.counter<c;emitEventCycle.counter+=1)eventBus[a][emitEventCycle.counter]&&eventBus[a][emitEventCycle.counter](b);emitEventCycle=null}